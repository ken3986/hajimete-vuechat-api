!function(e,n){for(var t in n)e[t]=n[t]}(exports,function(e){var n={};function t(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var s in e)t.d(r,s,function(n){return e[n]}.bind(null,s));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([,function(e,n,t){t(2).config();const r=t(3),s=r(),a=t(4);s.use(a());const o=t(5),c=t(7);s.use(c.json()),s.use(c.urlencoded({extended:!0}));const u=t(6),i={type:process.env.TYPE,project_id:process.env.PROJECT_ID,private_key_id:process.env.PRIVATE_KEY_ID,private_key:process.env.PRIVATE_KEY.replace(/\\n/g,"\n"),client_email:process.env.CLIENT_EMAIL,client_id:process.env.CLIENT_ID,auth_uri:process.env.AUTH_URI,token_uri:process.env.TOKEN_URI,auth_provider_x509_cert_url:process.env.AUTH_PROVIDER_X509_CERT_URL,client_x509_cert_url:process.env.CLIENT_X509_CERT_URL};u.apps.length||u.initializeApp({credential:u.credential.cert(i),databaseURL:process.env.DATABASE_URL});const p=u.database().ref("users"),l={id:"anon",name:"Anonymous",avatar:""};s.use((e,n,t)=>{if(e.user=l,null!=e.query.auth_token){let n=e.query.auth_token(n).then(n=>{let r={id:n.user_id,name:n.name,avatar:n.picture};e.user=r,t()}).catch(e=>{t()})}else t()});const d=r.Router();function f(e){let n=u.database().ref("channels"),t=new Date,r=new Date;r.setSeconds(r.getSeconds()+1);const s=`{\n      "messages": {\n        "1": {\n          "body": "Welcome to #${e} channel!",\n          "date": "${t.toJSON()}",\n          "user": {\n            "avatar": "",\n            "id": "robot",\n            "name": "Robot"\n          }\n        },\n        "2": {\n          "body": "はじめてのメッセージを投稿してみましょう。",\n          "date": "${r.toJSON()}",\n          "user": {\n            "avatar": "",\n            "id": "robot",\n            "name": "Robot"\n          }\n        }\n      }\n    }`;n.child(e).set(JSON.parse(s))}d.get("/",(e,n)=>{n.header("Content-Type","text/html"),n.send("<h1>default page</h1>")}),d.get("/test",(e,n)=>{n.header("Content-Type","text/plain"),n.send("test1 plain")}),d.get("/test2",async(e,n)=>{n.header("Content-Type","application/json; charset=utf-8");const t=await(r=p,new Promise((e,n)=>{r.on("value",n=>e(n.val()))}));var r;n.send(t)}),d.get("/test3",(e,n)=>{n.header("Content-Type","application/json; charset=utf-8"),n.send({value:process.env.KEY1})}),d.get("/channels",async(e,n)=>{u.database().ref("channels").once("value",(function(e){let t=new Array;e.forEach((function(e){let n=e.key;t.push(n)})),n.header("Content-Type","application/json; charset=utf-8"),n.send({channels:t})}))}),d.post("/channels",(e,n)=>{f(e.body.cname),n.header("Content-Type","application/json; charset=utf-8"),n.status(201).json({result:"ok "+e.body.cname})}),d.get("/channels/:cname/messages",(e,n)=>{let t=e.params.cname;u.database().ref(`channels/${t}/messages`).limitToLast(20).once("value",(function(e){let t=new Array;e.forEach((function(e){let n=e.val();n.id=e.key,t.push(n)})),t.reverse(),n.header("Content-Type","application/json; charset=utf-8"),n.send({messages:t})}))}),d.post("/channels/:cname/messages",(e,n)=>{let t=e.params.cname,r={date:(new Date).toJSON(),body:e.body.body,user:e.user};u.database().ref(`channels/${t}/messages`).push(r),n.header("Content-Type","application/json; charset=utf-8"),n.status(201).send({result:"ok"}),n.end()}),d.post("/reset",(e,n)=>{f("general"),f("random"),n.header("Content-Type","application/json; charset=utf8"),n.status(201).send({result:"ok"})}),s.use("/.netlify/functions/express",d),e.exports.handler=o(s)},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("serverless-http")},function(e,n){e.exports=require("firebase-admin")},function(e,n){e.exports=require("body-parser")}]));